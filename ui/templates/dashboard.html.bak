{% extends "base.html" %}

{% block title %}Dashboard - NBA Prediction System{% endblock %}

{% block page_title %}Performance Dashboard{% endblock %}

{% block extra_css %}
<style>
    .performance-card {
        transition: all 0.3s ease;
    }
    
    .performance-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .chart-container {
        height: 400px;
        position: relative;
    }
    
    .status-badge {
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
    }
    
    .model-metric {
        font-size: 1.8rem;
        font-weight: bold;
    }
    
    .metric-change {
        font-size: 0.9rem;
    }
    
    .metric-change.positive {
        color: #28a745;
    }
    
    .metric-change.negative {
        color: #dc3545;
    }
    
    .progress {
        height: 8px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Status Overview Row -->
<div class="row mb-4">
    <!-- API Status Card -->
    <div class="col-md-3 mb-4">
        <div class="card performance-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">API Status</h6>
                <div class="d-flex align-items-center">
                    <span class="badge bg-success me-2" id="api-status">Online</span>
                    <span class="text-muted small" id="api-version">v1.0.3</span>
                </div>
                <hr>
                <p class="mb-0 text-muted small">Last Updated: <span id="last-updated">Loading...</span></p>
            </div>
        </div>
    </div>
    
    <!-- Training Status Card -->
    <div class="col-md-3 mb-4">
        <div class="card performance-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Training Status</h6>
                <div class="d-flex align-items-center">
                    <span class="text-secondary fw-bold" id="training-status">Checking...</span>
                </div>
                <div id="training-progress" style="display: none;">
                    <div class="progress mt-2">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                    </div>
                    <p class="text-muted small mt-1 mb-0" id="training-progress-text">Training in progress...</p>
                </div>
                <hr>
                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-sm btn-primary" id="start-training-btn">
                        <i class="fas fa-play"></i> Start Training
                    </button>
                    <input type="password" class="form-control form-control-sm ms-2" id="api-token-input" placeholder="API Token" style="max-width: 120px;">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Drift Status Card -->
    <div class="col-md-3 mb-4">
        <div class="card performance-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Model Drift Status</h6>
                <div class="d-flex align-items-center">
                    <span class="badge bg-secondary me-2" id="drift-status">Checking...</span>
                </div>
                <hr>
                <p class="mb-0" id="drift-summary">Checking model drift status...</p>
            </div>
        </div>
    </div>
    
    <!-- Today's Predictions Card -->
    <div class="col-md-3 mb-4">
        <div class="card performance-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Today's Predictions</h6>
                <div class="d-flex align-items-center">
                    <span class="model-metric" id="todays-predictions-count">...</span>
                    <span class="ms-2">games</span>
                </div>
                <hr>
                <a href="/predictions" class="btn btn-sm btn-outline-primary">View Predictions</a>
            </div>
        </div>
    </div>
</div>

<!-- Performance Metrics Row -->
<div class="row mb-4">
    <!-- Overall Accuracy Card -->
    <div class="col-md-3 mb-4">
        <div class="card performance-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Overall Accuracy (7-day)</h6>
                <div class="d-flex align-items-end">
                    <span class="model-metric" id="overall-accuracy">...</span>
                    <span class="ms-1">%</span>
                    <span class="ms-2 metric-change positive" id="accuracy-change">...</span>
                </div>
                <div class="progress mt-2">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" id="accuracy-progress"></div>
                </div>
                <hr>
                <p class="mb-0 text-muted small">Based on all active models</p>
            </div>
        </div>
    </div>
    
    <!-- Moneyline Accuracy Card -->
    <div class="col-md-3 mb-4">
        <div class="card performance-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Moneyline Accuracy</h6>
                <div class="d-flex align-items-end">
                    <span class="model-metric" id="moneyline-accuracy">...</span>
                    <span class="ms-1">%</span>
                    <span class="ms-2 metric-change" id="moneyline-change">...</span>
                </div>
                <div class="progress mt-2">
                    <div class="progress-bar bg-primary" role="progressbar" style="width: 0%" id="moneyline-progress"></div>
                </div>
                <hr>
                <p class="mb-0 text-muted small">Best model: <span id="best-moneyline-model">...</span></p>
            </div>
        </div>
    </div>
    
    <!-- Spread Accuracy Card -->
    <div class="col-md-3 mb-4">
        <div class="card performance-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Spread Accuracy</h6>
                <div class="d-flex align-items-end">
                    <span class="model-metric" id="spread-accuracy">...</span>
                    <span class="ms-1">%</span>
                    <span class="ms-2 metric-change" id="spread-change">...</span>
                </div>
                <div class="progress mt-2">
                    <div class="progress-bar bg-info" role="progressbar" style="width: 0%" id="spread-progress"></div>
                </div>
                <hr>
                <p class="mb-0 text-muted small">Best model: <span id="best-spread-model">...</span></p>
            </div>
        </div>
    </div>
    
    <!-- Totals Accuracy Card -->
    <div class="col-md-3 mb-4">
        <div class="card performance-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Totals Accuracy</h6>
                <div class="d-flex align-items-end">
                    <span class="model-metric" id="totals-accuracy">...</span>
                    <span class="ms-1">%</span>
                    <span class="ms-2 metric-change" id="totals-change">...</span>
                </div>
                <div class="progress mt-2">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: 0%" id="totals-progress"></div>
                </div>
                <hr>
                <p class="mb-0 text-muted small">Best model: <span id="best-totals-model">...</span></p>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row mb-4">
    <!-- Performance Chart -->
    <div class="col-md-8 mb-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-line me-2"></i> Model Performance Trends
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="performance-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Model Comparison Chart -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-bar me-2"></i> Model Comparison
                </h5>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="model-comparison-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Model Status Table -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="card-title mb-0">
            <i class="fas fa-brain me-2"></i> Model Status
        </h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Status</th>
                        <th>Last Trained</th>
                        <th>Drift Status</th>
                        <th>7-Day Accuracy</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Random Forest -->
                    <tr>
                        <td>RandomForest</td>
                        <td><span class="badge bg-success" id="randomforest-status">Active</span></td>
                        <td id="randomforest-last-trained">Loading...</td>
                        <td><span class="badge bg-secondary" id="randomforest-drift">Checking...</span></td>
                        <td id="randomforest-accuracy">...</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" id="randomforest-retrain-btn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </td>
                    </tr>
                    <!-- XGBoost -->
                    <tr>
                        <td>XGBoost</td>
                        <td><span class="badge bg-success" id="xgboost-status">Active</span></td>
                        <td id="xgboost-last-trained">Loading...</td>
                        <td><span class="badge bg-secondary" id="xgboost-drift">Checking...</span></td>
                        <td id="xgboost-accuracy">...</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" id="xgboost-retrain-btn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </td>
                    </tr>
                    <!-- Bayesian -->
                    <tr>
                        <td>Bayesian</td>
                        <td><span class="badge bg-success" id="bayesian-status">Active</span></td>
                        <td id="bayesian-last-trained">Loading...</td>
                        <td><span class="badge bg-secondary" id="bayesian-drift">Checking...</span></td>
                        <td id="bayesian-accuracy">...</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" id="bayesian-retrain-btn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </td>
                    </tr>
                    <!-- Anomaly Detection -->
                    <tr>
                        <td>AnomalyDetection</td>
                        <td><span class="badge bg-success" id="anomalydetection-status">Active</span></td>
                        <td id="anomalydetection-last-trained">Loading...</td>
                        <td><span class="badge bg-secondary" id="anomalydetection-drift">Checking...</span></td>
                        <td id="anomalydetection-accuracy">...</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" id="anomalydetection-retrain-btn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </td>
                    </tr>
                    <!-- Model Mixing -->
                    <tr>
                        <td>ModelMixing</td>
                        <td><span class="badge bg-success" id="modelmixing-status">Active</span></td>
                        <td id="modelmixing-last-trained">Loading...</td>
                        <td><span class="badge bg-secondary" id="modelmixing-drift">Checking...</span></td>
                        <td id="modelmixing-accuracy">...</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" id="modelmixing-retrain-btn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </td>
                    </tr>
                    <!-- Ensemble Stacking -->
                    <tr>
                        <td>EnsembleStacking</td>
                        <td><span class="badge bg-success" id="ensemblestacking-status">Active</span></td>
                        <td id="ensemblestacking-last-trained">Loading...</td>
                        <td><span class="badge bg-secondary" id="ensemblestacking-drift">Checking...</span></td>
                        <td id="ensemblestacking-accuracy">...</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" id="ensemblestacking-retrain-btn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Toast Container for Notifications -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11" id="toast-container"></div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js for data visualization -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

<!-- Custom API client -->
<script src="{{ url_for('static', filename='js/api_client.js') }}"></script>

<!-- Dashboard functionality -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
